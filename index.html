<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Anger Rescue — 情绪缓解小工具</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <style>
    /* Simple shred animation */
    @keyframes shred {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      70% { transform: translateY(20px) rotate(8deg); opacity: 0.8; }
      100% { transform: translateY(200px) rotate(20deg); opacity: 0; }
    }
    .shredding { animation: shred 0.7s ease forwards; }
  </style>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center p-6">
  <div id="root" class="w-full max-w-md"></div>

  <script>
  const e = React.createElement;
  const { useState, useEffect, useRef } = React;

  function App(){
    const [view, setView] = useState('home');
    const [ventText, setVentText] = useState('');
    const [shredded, setShredded] = useState(false);
    const [countdown, setCountdown] = useState(0);
    const [breathStep, setBreathStep] = useState(0);
    const [microTask, setMicroTask] = useState(generateMicroTask());
    const [mood, setMood] = useState(6);
    const inputRef = useRef(null);

    useEffect(()=> {
      let t;
      if(countdown > 0){
        t = setTimeout(()=> setCountdown(c => c - 1), 1000);
      } else if (countdown === 0 && breathStep > 0) {
        // auto advance to next step if user doesn't click; keep it simple: stop after one step
      }
      return ()=> clearTimeout(t);
    }, [countdown, breathStep]);

    function generateMicroTask(){
      const tasks = [
        '站起来伸展 30 秒',
        '喝一杯水',
        '给同事发一条一行的更新',
        '开窗透气 30 秒',
        '整理一个文件夹里的三件事',
        '写下今天的一件小胜利'
      ];
      return tasks[Math.floor(Math.random()*tasks.length)];
    }

    function startBoxBreathing(){
      setBreathStep(1);
      setCountdown(4);
      setView('breath');
    }

    function nextBreathStep(){
      if(breathStep >= 4){
        setBreathStep(0);
        setCountdown(0);
        setView('home');
      } else {
        setBreathStep(s => s + 1);
        setCountdown(4);
      }
    }

    function shredVent(){
      setShredded(true);
      setTimeout(()=>{
        setVentText('');
        setShredded(false);
        setView('home');
      }, 700);
    }

    function quickReframe(){
      const suggestions = [
        '把这件事当作信息：它提示了哪些边界需要明确。写下一个可以立刻做的小边界。',
        '你的情绪说明你在乎这件事。挑一个可执行的小点去试试，而不是想全盘改变。',
        '先把能控制的拆出来：第一件能做的事是______。',
        '把这股能量转为一个 5 分钟的行动，用行动消耗掉紧张感。'
      ];
      return suggestions[Math.floor(Math.random()*suggestions.length)];
    }

    return e('div', {className:'bg-white/95 backdrop-blur-sm rounded-2xl shadow p-4 ring-1 ring-slate-200'},
      e('div', {className:'flex items-center justify-between'},
        e('h3', {className:'text-lg font-semibold'}, 'Anger Rescue'),
        e('div', {className:'text-sm text-slate-500'}, '微交互 · 减压')
      ),
      e('div', {className:'mt-3'},
        view === 'home' && e('div', null,
          e('p', {className:'text-sm text-slate-600'}, '感觉生气了？点一个小动作，让情绪先动起来而不是卡住。'),
          e('div', {className:'grid grid-cols-2 gap-2 mt-4'},
            e('button', {onClick: ()=>{ setView('vent'); setTimeout(()=> inputRef.current?.focus(), 60) }, className:'p-2 rounded-lg border text-sm'}, '写下来并碎纸'),
            e('button', {onClick: startBoxBreathing, className:'p-2 rounded-lg border text-sm'}, '盒式呼吸 1 轮'),
            e('button', {onClick: ()=> setView('ground'), className:'p-2 rounded-lg border text-sm'}, '5-4-3 地面法'),
            e('button', {onClick: ()=>{ setMicroTask(generateMicroTask()); setView('task') }, className:'p-2 rounded-lg border text-sm'}, '完成一个微任务'),
            e('button', {onClick: ()=> setView('reframe'), className:'col-span-2 p-2 rounded-lg border text-sm'}, '快速换个角度（AI 风格建议）')
          ),
          e('div', {className:'mt-4 flex items-center justify-between'},
            e('div', {className:'text-xs text-slate-500'}, '情绪刻度'),
            e('input', {type:'range', min:0, max:10, value:mood, onChange: (e)=> setMood(Number(e.target.value))})
          )
        ),

        view === 'vent' && e('div', null,
          e('textarea', {ref: inputRef, value: ventText, onChange: (e)=> setVentText(e.target.value), rows:5, className:'w-full rounded-md border p-2 text-sm', placeholder:'把气写下来：不需要有逻辑，只要真实'}),
          e('div', {className:'flex gap-2 mt-2'},
            e('button', {onClick: shredVent, disabled: !ventText, className:'flex-1 p-2 rounded-md bg-red-50 border text-sm'}, '撕碎并清空'),
            e('button', {onClick: ()=>{ navigator.clipboard?.writeText(ventText); setView('home') }, className:'p-2 rounded-md border text-sm'}, '复制')
          ),
          shredded && e('div', {className:'mt-2 p-2 bg-yellow-50 rounded shredding'}, '🗑️ 已撕碎 —— 呼吸一下'),
          e('div', {className:'mt-3 text-right'},
            e('button', {onClick: ()=> setView('home'), className:'text-sm text-slate-500'}, '返回')
          )
        ),

        view === 'breath' && e('div', {className:'flex flex-col items-center py-4'},
          e('div', {className:'text-sm text-slate-600 mb-2'}, '盒式呼吸 — 当前步骤: ' + (breathStep === 1 ? '吸气' : breathStep === 2 ? '屏住' : breathStep === 3 ? '呼气' : breathStep === 4 ? '屏住' : '')),
          e('div', {className:'w-36 h-36 rounded-full grid place-items-center border'},
            e('div', {className:'text-2xl font-semibold'}, countdown > 0 ? countdown : '—')
          ),
          e('div', {className:'mt-3 flex gap-2'},
            e('button', {onClick: nextBreathStep, className:'p-2 rounded-md border text-sm'}, '下一步'),
            e('button', {onClick: ()=>{ setView('home'); setBreathStep(0); setCountdown(0) }, className:'p-2 rounded-md text-sm'}, '结束')
          ),
          e('div', {className:'mt-3 text-xs text-slate-500'}, '提示：吸 4s → 屏 4s → 呼 4s → 屏 4s. 做 1 轮即可明显平稳心率。')
        ),

        view === 'ground' && e('div', null,
          e('ol', {className:'list-decimal ml-5 text-sm space-y-2 text-slate-700'},
            e('li', null, '看见并说出 5 样你能看到的东西'),
            e('li', null, '听见并说出 4 样你能听到的声音'),
            e('li', null, '触摸并说出 3 样你能碰到的东西'),
            e('li', null, '闻到并说出 2 样气味（如果没有就想象）'),
            e('li', null, '尝试说出 1 样你现在能感受到的味道或口腔感受')
          ),
          e('div', {className:'mt-3 flex justify-between'},
            e('button', {onClick: ()=> setView('home'), className:'p-2 rounded-md border text-sm'}, '完成'),
            e('button', {onClick: ()=>{ setView('task'); setMicroTask(generateMicroTask()) }, className:'p-2 rounded-md text-sm'}, '跳到微任务')
          )
        ),

        view === 'task' && e('div', null,
          e('div', {className:'text-sm text-slate-700'}, '微任务（建议 1–5 分钟）'),
          e('div', {className:'mt-2 p-3 rounded-md bg-gray-50 text-sm'}, microTask),
          e('div', {className:'mt-3 flex gap-2'},
            e('button', {onClick: ()=> setView('home'), className:'flex-1 p-2 rounded-md border text-sm'}, '我做完了'),
            e('button', {onClick: ()=> setMicroTask(generateMicroTask()), className:'p-2 rounded-md text-sm'}, '换一个')
          )
        ),

        view === 'reframe' && e('div', null,
          e('div', {className:'text-sm text-slate-700'}, '快速建议（本地生成，安全、无保存）'),
          e('div', {className:'mt-2 p-3 rounded-md bg-blue-50 text-sm'}, quickReframe()),
          e('div', {className:'mt-3 flex gap-2'},
            e('button', {onClick: ()=> setView('home'), className:'flex-1 p-2 rounded-md border text-sm'}, '好 我回去试试'),
            e('button', {onClick: ()=> alert('如果你想接入在线AI以获得个性化建议，我可以给你后端示例和安全说明。') , className:'p-2 rounded-md text-sm'}, '需要更多建议')
          )
        )
      ),
      e('div', {className:'mt-4 text-xs text-slate-400'}, '注：此工具为情绪缓解辅助，不替代专业心理咨询。如长期情绪困扰请寻求专业帮助。')
    );
  }

  ReactDOM.createRoot(document.getElementById('root')).render(e(App));
  </script>
</body>
</html>
